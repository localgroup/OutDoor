<% layout('layouts/boilerplate') %>

<div class="row">
    <h1 class="text-centre">New Campground</h1>
    <div class="col-6 offset-3">
        
    <form id="newCampgroundForm" action="/campgrounds" method="POST" class="validated-form" novalidate enctype="multipart/form-data">
        <div class="mb-3">
            <label class="form-label" for="title">Title</label>
            <input class="form-control" type="text" id="title" name="campground[title]" required>
            <div class="valid-feedback">
                Looks good!
            </div>
        </div>
        <br>
        <div class="mb-3">
            <label class="form-label" for="location">Location</label>
            <input class="form-control" type="text" id="location" name="campground[location]" required>
            <div class="valid-feedback">
                Looks good!
            </div>
        </div>

        <!-- file input -->
        <div class="mb-3">
            <label class="form-label" for="price">Add Campground Image(s):</label>
            <input type="file" class="filepond" id="image" name="image" multiple>
        </div>


        <div class="mb-3">
            <label class="form-label" for="price">Campground Price</label>
            <div class="input-group">
                <span class="input-group-text" id="price-label">$</span>
                <input type="text" class="form-control" id="price" placeholder="0.00" name="campground[price]" required>
                <div class="valid-feedback">
                    Looks good!
                </div>
            </div>
        </div>
          

        <div class="mb-3">
            <label class="form-label" for="description">Description</label>
            <textarea class="form-control" type="text" id="description" name="campground[description]" required></textarea>
            <div class="valid-feedback">
                Looks good!
            </div>
        </div>


        <br>
        <div class="mb-3">
            <button class="btn btn-success">Add Campground</button>

        </div>
        
    </form>

</body>
<br>
<footer>
    <a href="/campgrounds">All Campgrounds</a>
</footer>

    </div>

    <script>
        // register the FilePond Image Preview plugin
        FilePond.registerPlugin(FilePondPluginImagePreview);
       
        // select the file input element that you want to use FilePond with
        const inputElement = document.querySelector('input#image');
       
        // create a FilePond instance
        const pond = FilePond.create(inputElement, {
          instantUpload: false,
          allowMultiple: true,
          name: 'image'
        });
       
        // handle form submission
        document.getElementById('newCampgroundForm').addEventListener('submit', async (e) => {
          e.preventDefault(); // prevent the form from submitting normally, instead we need to handle the form submission manually with JavaScript when using FilePond
       
          // get the form element
          const form = e.target;
       
          // create a new FormData object
          const formData = new FormData(form);
       
          // remove empty values for 'image' field
          formData.delete('image');
       
          // add FilePond files to the form data
          const files = pond.getFiles();
          for (let i = 0; i < files.length; i++) {
            formData.append('image', files[i].file, files[i].file.name);
          }
       
          // submit the form using fetch
          try {
            const response = await fetch(form.action, {
              method: form.method,
              body: formData
            });
       
            if (!response.ok) {
              throw new Error('Network response was not ok ' + response.statusText);
            }
       
            // if form submission is successful, follow the redirect from the response
            if (response.redirected) {
              window.location.href = response.url;
            }
          } catch (error) {
            console.error('There was a problem with the fetch operation:', error);
          }
        });
      </script>


</div>



